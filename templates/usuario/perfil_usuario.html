<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Perfil de Usuario</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* Efecto de hover en el botón de cámara */
    .btn-cambiar-imagen:hover i {
      color: #0d6efd;
      transform: scale(1.15);
      transition: all 0.2s ease;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-6">
        <div class="card rounded-4 shadow-lg p-4 position-relative">
          <a href="{{ url_for('main.logout') }}" class="btn btn-light position-absolute end-0 top-0 m-3">Cerrar sesión</a>
          
          <!-- Sección Avatar -->
<div class="d-flex flex-column align-items-center mb-4">
  <div style="position:relative;">
    <span style="display:block;width:130px;height:130px;background:#e3f2fd;border-radius:50%;box-shadow:0 0 0 8px #1673ff44,0 4px 16px #1673ff22;position:relative;">
      
      <!-- Imagen del usuario o avatar por defecto -->
  <img src="{{ url_for('static', filename='img/usuarios/' + (usuario.imagen if usuario.imagen else 'avatar.png')) }}"
    alt="Avatar"
    style="width:110px;height:110px;border-radius:50%;object-fit:cover; position:absolute;top:10px;left:10px;">

      
      <!-- Botón con ícono de cámara -->
      <button type="button" 
              class="btn btn-light border position-absolute shadow-sm btn-cambiar-imagen" 
              style="bottom:10px;right:10px;border-radius:50%;width:42px;height:42px;
                    display:flex;align-items:center;justify-content:center;
                    background-color:white;"
              data-bs-toggle="modal" data-bs-target="#modalEditarImagen"
              title="Cambiar imagen de perfil">
        <i class="bi bi-camera-fill text-primary fs-5"></i>
      </button>
    </span>
  </div>

  <!-- Modal para editar imagen -->
  <div class="modal fade" id="modalEditarImagen" tabindex="-1" aria-labelledby="modalEditarImagenLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="POST" action="{{ url_for('main.editar_imagen_usuario') }}" enctype="multipart/form-data">
          <div class="modal-header">
            <h5 class="modal-title" id="modalEditarImagenLabel">Editar imagen de perfil</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <input type="file" class="form-control" name="imagen" accept="image/*" required>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


          <!-- Datos del perfil -->
          <h2 class="fw-bold mb-4">Perfil</h2>
          <form>
            <div class="mb-3">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control form-control-lg" value="{{ usuario.usuario }}" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Correo</label>
              <input type="email" class="form-control form-control-lg" value="{{ usuario.correo }}" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Dirección</label>
              <input type="text" class="form-control form-control-lg" value="{{ usuario.direccion }}" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Fecha de Nacimiento</label>
              <input type="date" class="form-control form-control-lg" value="{{ usuario.fechaNacimiento if usuario.fechaNacimiento != 'No especificada' else '' }}" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Rol</label>
              <input type="text" class="form-control form-control-lg text-primary fw-bold bg-light" value="{{ usuario.rol or 'Administrador' }}" readonly>
            </div>
            <div class="d-flex justify-content-end mt-4">
              <button type="button" class="btn btn-primary px-4" data-bs-toggle="modal" data-bs-target="#modalEditar">Editar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de edición de datos -->
  <div class="modal fade" id="modalEditar" tabindex="-1" aria-labelledby="modalEditarLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="POST" action="{{ url_for('main.editar_perfil_usuario') }}">
          <div class="modal-header">
            <h5 class="modal-title" id="modalEditarLabel">Editar Perfil</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" name="nombre" value="{{ usuario.usuario }}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email" value="{{ usuario.correo }}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Dirección</label>
              <input type="text" class="form-control" name="direccion" value="{{ usuario.direccion }}">
            </div>
            <div class="mb-3">
              <label class="form-label">Fecha de Nacimiento</label>
              <input type="date" class="form-control" name="fechaNacimiento" value="{{ usuario.fechaNacimiento }}">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
