{% extends 'dashboard/base.html' %}

{% block content %}

<br>
<br>
<div class="d-flex justify-content-end gap-2 mt-5 mb-4" style="margin-top: 120px;">
  <!-- Botón que lleva a la vista de huéspedes -->
  <a href="{{ url_for('main.ver_huespedes') }}" class="btn btn-primary">
    <i class="bi bi-people-fill"></i> Huéspedes
  </a>

  <!-- Botón que lleva a la vista de estadísticas -->
  <a href="{{ url_for('main.estadisticas') }}" class="btn btn-info">
    <i class="bi bi-bar-chart-fill"></i> Estadísticas
  </a>

  <!-- Botón que abre el modal de agregar habitación -->
  <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNuevaHabitacion">
    <i class="bi bi-plus-circle"></i> Agregar Habitación
  </button>
</div>


  <div class="container mt-5">
    <div class="row" id="habitaciones-admin">
      {% for h in habitaciones %}
      <div class="col-md-4 mb-4">
        <div class="card habitacion-card estado-{{ h.estado|lower }}"
          style="min-height: 420px; max-height: 420px; display: flex; flex-direction: column; justify-content: space-between;">

          <!-- Imagen -->
          <img src="{{ url_for('static', filename=h.imagen if h.imagen else 'img/default.jpg') }}" 
               class="card-img-top" alt="{{ h.nombre }}" 
               style="height: 200px; object-fit: cover;">

          <!-- Contenido -->
          <div class="card-body" style="flex: 1 1 auto;">
            <h5 class="card-title">{{ h.nombre }}</h5>
            <p class="card-text">
              Cupo: {{ h.cupo_personas }} <br>
              Precio: ${{ '{:,.0f}'.format(h.precio) }} COP
            </p>

            <!-- Botón Leer más -->
            <button type="button" class="btn btn-link p-0" data-bs-toggle="modal"
              data-bs-target="#modalHabitacion{{ h.id }}">
              Leer más
            </button>

            <!-- Estado -->
            <span class="badge estado-label {{ h.estado|lower }}">{{ h.estado }}</span>

            <!-- Botones Editar/Eliminar -->
            <div class="d-flex justify-content-between mt-3">
              <a href="{{ url_for('main.editar_habitacion_admin', habitacion_id=h.id) }}" 
                 class="btn btn-warning btn-sm" title="Editar">
                <i class="bi bi-pencil-square"></i> Editar
              </a>
              <form action="{{ url_for('main.eliminar_habitacion_admin', habitacion_id=h.id) }}" 
                    method="POST" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm" title="Eliminar"
                  onclick="return confirm('¿Seguro que deseas eliminar esta habitación?')">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Modal sin botones de editar/eliminar -->
        <div class="modal fade" id="modalHabitacion{{ h.id }}" tabindex="-1"
          aria-labelledby="modalHabitacionLabel{{ h.id }}" aria-hidden="true">
          <div class="modal-dialog custom-modal-dialog modal-dialog-centered">
            <div class="modal-content shadow-lg border-0">

              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalHabitacionLabel{{ h.id }}">{{ h.nombre }}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Cerrar"></button>
              </div>

              <div class="modal-body text-center">
                <!-- Imagen -->
                <img
                  src="{{ url_for('static', filename=h.imagen if h.imagen else 'img/default.jpg') }}"
                  class="img-fluid rounded mb-3" alt="{{ h.nombre }}"
                  style="max-height: 220px; object-fit: cover;">

                <!-- Información -->
                <div class="text-start mx-auto" style="max-width: 400px;">
                  {% if h.descripcion %}
                  <p><strong>Descripción:</strong> {{ h.descripcion }}</p>
                  {% else %}
                  <p><strong>Descripción:</strong> <span class="text-muted">Sin descripción</span></p>
                  {% endif %}

                  <p><strong>Cupo:</strong> {{ h.cupo_personas }}</p>
                  <p><strong>Precio:</strong> ${{ '{:,.0f}'.format(h.precio) }} COP</p>
                  <p><strong>Estado:</strong>
                    <span
                      class="badge bg-{% if h.estado|lower == 'disponible' %}success{% elif h.estado|lower == 'mantenimiento' %}warning{% else %}danger{% endif %}">
                      {{ h.estado }}
                    </span>
                  </p>
                </div>
              </div>

              <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-outline-light text-dark border"
                  data-bs-dismiss="modal">
                  Cerrar
                </button>
              </div>

            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Modal para agregar nueva habitación -->
    <div class="modal fade" id="modalNuevaHabitacion" tabindex="-1"
      aria-labelledby="modalNuevaHabitacionLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">

          <!-- Header -->
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="modalNuevaHabitacionLabel">Agregar Nueva Habitación</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
              aria-label="Cerrar"></button>
          </div>

          <!-- Body con formulario -->
          <div class="modal-body">
            <form action="{{ url_for('main.hospedaje_nueva') }}" method="POST" enctype="multipart/form-data"
              class="p-3">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="nombre" class="form-label">Nombre</label>
                  <input type="text" class="form-control" id="nombre" name="nombre" required>
                </div>
                <div class="col-md-3">
                  <label for="precio" class="form-label">Precio</label>
                  <input type="number" class="form-control" id="precio" name="precio" min="0" step="0.01"
                    required>
                </div>
                <div class="col-md-3">
                  <label for="cupo_personas" class="form-label">Cupo Personas</label>
                  <input type="number" class="form-control" id="cupo_personas" name="cupo_personas"
                    min="1" required>
                </div>
                <div class="col-md-6">
                  <label for="estado" class="form-label">Estado</label>
                  <select class="form-select" id="estado" name="estado">
                    <option value="Disponible">Disponible</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Ocupado">Ocupado</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="imagen" class="form-label">Imagen</label>
                  <input type="file" class="form-control" id="imagen" name="imagen" accept="image/*"
                    required>
                </div>
                <div class="col-md-12">
                  <label for="descripcion" class="form-label">Descripción</label>
                  <textarea class="form-control" id="descripcion" name="descripcion" rows="3"
                    required></textarea>
                </div>
            </div>

            <!-- Footer con botones -->
            <div class="modal-footer mt-3">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-success">Guardar</button>
            </div>
            </form>
        </div>
        </div>
    </div>
    </div>
  </div>
</div>

{% endblock %}
